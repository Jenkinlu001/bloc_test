# linux设置程序开机自启动
在上一篇博客中，我介绍了两种设置linux开机自启动用户程序的方法，在这里，我们将来讨论另一种开机自启动的方式。  

## linux的启动方式
自linus torvalds发布linux 1.0以来，由于它的开源特性，引得世界各地的程序员以参与内核开发为荣，虽然linux经历了几段艰难的时光，但总归是守得云开见月明，目前在移动端和服务器端占据主导位置，也是由于其开源的特性，linux的内核以及发行版一直在马不停蹄地更新换代，而它也正在变得越来越优秀。
## system V，upstart，systemd  
在早期的linux中，linux的启动方式一直是采用system V的标准，即sysvinit的方式，这种启动方式足够简单，将服务程序根据既定的启动优先级顺序启动，但是这种做法在效率上表现不尽如人意，早期的服务器并不用关注启动问题，因为服务器并不对启动时间做过多要求。但是随着嵌入式移动设备的发展，linux启动速度的优化就不得不提上日程。  
针对system V方式的顺序启动方式，后面有人推出了upstart启动方式，这种方式实现了并行启动，而且优化了一些init方式启动的缺点，并被一些发行版所采用。   
在upstart推行但并未成熟的时候，又有人推出了systemd，在启动方面，systemd有更激进的策略，而且systemd目前已经应用到各大发行版中。

需要注意的是，虽然博主在上面一直在对比启动方式，但是这不管是system V和upstart还是systemd，其实都是一套完整的管理软件包，用于管理整个linux系统服务的启动、停止、退出和应用层的资源清理，而且他们都是应用程序，并非内核层面的软件。  

## system V启动方式
linux操作系统的启动是从bootloader开始，在内核加载启动完成之后，用户空间的第一个进程就是初始化进程，这个初始化进程的PID为1，而且由于linux产生进程的方式是调用fork()进行复制，所以初始化进程是所有进程的祖先，拥有对所以服务进程的控制权。在system V的启动方式中，初始化进程就是init进程，然后由init进程来启动其他服务进程。  
系统在获取配置信息后，进入相应的rcX.d文件目录(X对应linux下的运行级别，0-6)，在rcX.d文件目录下，存放着需要开机启动的脚本，这里的脚本其实都是一些软链接文件，而真实的启动脚本被放置在/etc/init.d下。  
这些脚本中文件名以S开头的就是启动时需要运行的脚本，而S后面跟的数字就是启动时的优先级，数字越大优先级越低，所有脚本根据优先级排队启动，当所有脚本都执行完成之后，再执行rc.local.  
别忘了上面提到的，system V风格的管理系统并不仅仅负责开机启动，系统关闭时它同样需要负责清理工作。  
比如一些脏数据的写回，如果数据还在缓存中就unmount文件系统，文件数据就会丢失，它也需要处理这些棘手的问题。  
同样的，这种操作遵循着rcX.d脚本中的规矩，在rcX.d目录下还有一种K开头的脚本，这些脚本就是在系统关闭时被调用。

    Tip:
    千万不要以为linux的关机就是断电就行，否则linux的磁盘读写缓存机制会给你教训。